# Plan de Mejoramiento ( Programación con Node.js y APIs REST): Creación de una API REST para un Sistema de Asistencia de Estudiantes


## Actividad de Proyecto: 

- Programación con Node.js y APIs REST

## Competencia: 

- Estructurar propuesta técnica de servicio de tecnología de la información según requisitos técnicos y normativa
220501094

## Resultado de aprendizaje: 

- Validar las condiciones de la propuesta técnica del software de acuerdo con los intereses de las partes.

Este plan de mejoramiento detalla la implementación de una API RESTful para un sistema de asistencia de estudiantes, utilizando **NestJS** como framework backend, **Prisma** como ORM para manejar la base de datos, y **MySQL** como motor de base de datos. El sistema permitirá gestionar la asistencia de estudiantes en un entorno educativo (por ejemplo, una escuela o universidad), registrando información sobre estudiantes, cursos, profesores y registros de asistencia. 

#### 1. Descripción General del Sistema
El sistema de asistencia de estudiantes permitirá:

- Gestionar **estudiantes**: registrar, consultar, actualizar y eliminar información de estudiantes.
- Gestionar **cursos**: organizar asignaturas o clases en las que los estudiantes están inscritos.
- Gestionar **profesores**: registrar información de los docentes que imparten los cursos.
- Registrar **asistencias**: marcar la asistencia o ausencia de estudiantes en sesiones específicas de un curso, con fecha y estado.
- Consultar reportes básicos, como asistencias por estudiante, curso o fecha.

La API será RESTful, utilizando verbos HTTP estándar (GET, POST, PUT, DELETE), respuestas en formato JSON y códigos de estado HTTP apropiados (200 OK, 201 Created, 404 Not Found, 400 Bad Request). 

#### 2. Tecnologías y Requisitos Previos
- **NestJS**: Framework para estructurar la aplicación en módulos, controladores, servicios e inyección de dependencias. Usar la versión más reciente compatible (alrededor de v10 o superior en 2025).
- **Prisma**: ORM para definir el esquema de la base de datos, generar migraciones y realizar consultas type-safe.
- **MySQL**: Base de datos relacional. Usar una instancia local o en la nube (e.g., Docker o PlanetScale).
- **Otras dependencias**:
  - @nestjs/common, @nestjs/core para el core de NestJS.
  - @prisma/client para el cliente Prisma.
  - class-validator y class-transformer para validación de datos en los DTOs.

**Requisitos previos**:

- Instalar **Node.js** (versión LTS, e.g., v20 o superior) y un gestor de paquetes (npm, yarn o pnpm).
- Instalar la CLI de **NestJS** globalmente.
- Configurar una base de datos MySQL local y una instancia remota. Crear una base de datos vacía llamada "attendance_db".
- Instalar la CLI de **Prisma** globalmente.
- Usar un editor de código como VS Code con extensiones para NestJS y Prisma.

#### 3. Diseño de la Base de Datos (Esquema Prisma)
Definir el esquema en un archivo `schema.prisma` en la raíz del proyecto. Este esquema modelará las entidades y relaciones necesarias.

- **Modelo Student**:

    - Campos: id (int, auto-incremental, primary key), firstName (string, requerido), lastName (string, requerido), email (string, opcional, único, formato email), enrollmentNumber (string, requerido, único), createdAt (datetime, default now), updatedAt (datetime, on update now).
    - Relaciones: hasMany Attendance (registros de asistencia).

- **Modelo Course**:

    - Campos: id (int, auto-incremental, primary key), name (string, requerido, único), description (string, opcional), teacherId (int, requerido, foreign key a Teacher), createdAt (datetime, default now), updatedAt (datetime, on update now).
    - Relaciones: belongsTo Teacher, hasMany Attendance.

- **Modelo Teacher**:

    - Campos: id (int, auto-incremental, primary key), firstName (string, requerido), lastName (string, requerido), email (string, opcional, único, formato email), createdAt (datetime, default now), updatedAt (datetime, on update now).
    - Relaciones: hasMany Course.

- **Modelo Attendance**:

    - Campos: id (int, auto-incremental, primary key), studentId (int, requerido, foreign key a Student), courseId (int, requerido, foreign key a Course), date (datetime, requerido, default now), status (enum: 'PRESENT' | 'ABSENT' | 'LATE', requerido), notes (string, opcional).
    - Relaciones: belongsTo Student, belongsTo Course.

Configurar el datasource en el schema.prisma para MySQL, con la URL de conexión (e.g., mysql://user:pass@localhost:3306/attendance_db). Usar el provider "mysql".

Generar el cliente Prisma y aplicar migraciones para crear las tablas en la base de datos tras definir el esquema.

#### 4. Estructura del Proyecto en NestJS

Organizar el proyecto en una estructura modular estándar de NestJS para escalabilidad:

- **src/**: Carpeta principal de código fuente.
  - **app.module.ts**: Módulo raíz que importa todos los demás módulos.
  - **main.ts**: Punto de entrada para iniciar la app (escuchar en puerto 3000).
  - **prisma/**: Carpeta para el servicio Prisma global (e.g., prisma.service.ts para inyectar el cliente Prisma).
  - **students/**: Módulo para estudiantes (students.module.ts, students.service.ts, students.controller.ts, DTOs como create-student.dto.ts y update-student.dto.ts).
  - **courses/**: Similar al de estudiantes.
  - **teachers/**: Similar.
  - **attendances/**: Similar, con lógica para validar registros de asistencia.
- **prisma/schema.prisma**: Esquema de la base de datos.
- Archivos de configuración: .env para variables de entorno (e.g., DATABASE_URL), tsconfig.json para TypeScript.

Usar DTOs (Data Transfer Objects) para validar y tipar los cuerpos de las requests (e.g., usando class-validator con decoradores como @IsString(), @IsEnum(), @IsEmail()).

#### 5. Pasos Detallados para Construir la API

**Paso 1: Inicialización del Proyecto**

- Crear un nuevo proyecto NestJS usando la CLI (`nest new attendance-system`).
- Instalar dependencias: @nestjs/common, @nestjs/core, @prisma/client, prisma, class-validator, class-transformer.
- Configurar el archivo .env con la URL de conexión a MySQL (DATABASE_URL).
- Crear el esquema Prisma como se describió en la sección 3.
- Ejecutar `npx prisma generate` para generar el cliente Prisma y `npx prisma migrate dev` para aplicar migraciones y crear las tablas.

**Paso 2: Configuración Global de Prisma**

- Crear un servicio global (PrismaService) que extienda PrismaClient y se inyecte en la app.

**Paso 3: Creación de Módulos, Servicios y Controladores**
Para cada entidad (Students, Courses, Teachers, Attendances):

- Generar el **módulo** para cada entidad.
- En el **servicio**: Implementar métodos CRUD (findAll, findOne, create, update, remove) usando Prisma. 
- En el **controlador**: Definir rutas base y endpoints con decoradores @Get, @Post, @Put, @Delete.
- Crear DTOs para los bodies de POST y PUT.

**Paso 4: Definición Detallada de Endpoints**

Todos los endpoints responderán en JSON, usando códigos HTTP estándar y manejando errores (e.g., HttpException para 404 si no existe un recurso).

- **Estudiantes (/students)**:

    - GET /students: Lista todos los estudiantes con conteo de asistencias (usar _count en Prisma). Incluir filtro opcional por query param: ?enrollmentNumber=string para buscar por número de matrícula.
    - GET /students/:id: Retorna un estudiante específico por ID, incluyendo asistencias asociadas.
    - POST /students: Crea un nuevo estudiante. Body: {firstName: string, lastName: string, email?: string, enrollmentNumber: string}. Validar unicidad de email y enrollmentNumber.
    - PUT /students/:id: Actualiza un estudiante. Body parcial: mismos campos que POST, opcionales.
    - DELETE /students/:id: Elimina un estudiante, validando que no tenga asistencias asociadas.

- **Cursos (/courses)**:

    - GET /courses: Lista todos los cursos con su profesor y conteo de asistencias.
    - GET /courses/:id: Retorna un curso específico con profesor y asistencias.
    - POST /courses: Crea un nuevo curso. Body: {name: string, description?: string, teacherId: number}. Validar que teacherId exista.
    - PUT /courses/:id: Actualiza un curso.
    - DELETE /courses/:id: Elimina, validando que no tenga asistencias asociadas.

- **Profesores (/teachers)**:

    - GET /teachers: Lista todos los profesores con conteo de cursos asignados.
    - GET /teachers/:id: Retorna un profesor específico con sus cursos.
    - POST /teachers: Crea un nuevo profesor. Body: {firstName: string, lastName: string, email?: string}. Validar unicidad de email.
    - PUT /teachers/:id: Actualiza.
    - DELETE /teachers/:id: Elimina, validando que no tenga cursos asociados.

- **Asistencias (/attendances)**:

    - GET /attendances: Lista todos los registros de asistencia, con filtros opcionales: ?studentId=number, ?courseId=number, ?date=YYYY-MM-DD.
    - GET /attendances/:id: Retorna un registro específico con estudiante y curso.
    - POST /attendances: Crea un nuevo registro. Body: {studentId: number, courseId: number, status: 'PRESENT'|'ABSENT'|'LATE', date?: datetime, notes?: string}. Validar que studentId y courseId existan, y que no exista un registro para el mismo estudiante, curso y fecha.
    - PUT /attendances/:id: Actualiza un registro (e.g., cambiar status o notes).
    - DELETE /attendances/:id: Elimina un registro.

**Paso 5: Pruebas**

- Probar endpoints con Postman o curl: Verificar cada operación CRUD, respuestas JSON, códigos HTTP y manejo de errores.

- Usar Prisma Studio para inspeccionar datos en la base de datos durante desarrollo.

#### 6. Condiciones para la Evaluación del Plan de Mejoramiento
Para evaluar el cumplimiento de este plan de mejoramiento, se aplicarán las siguientes condiciones obligatorias. Estas aseguran que el aprendiz demuestre no solo la implementación técnica, sino también la comprensión y la capacidad de ejecución en tiempo real:

1. **Entrega de la API RESTful Funcionando**: El aprendiz debe entregar la API RESTful completamente operativa. Esto incluye un repositorio de código fuente (En GitHub) con el proyecto completo, instrucciones para su ejecución local (README con pasos para instalar dependencias, configurar la base de datos y correr el servidor). La API debe cumplir con todos los endpoints y lógicas descritas, conectarse correctamente a MySQL vía Prisma. Demostrar la funcionalidad de la API mediante pruebas con Postman o curl. La duración estimada de esta sesión es de 30 minutos.

2. **Realización del Proyecto desde Cero en Tiempo Real**: El estudiante debe realizar todo el proyecto desde cero en una sesión en tiempo real, explicando cada paso para la creación de la API REST full. Esto incluye: inicialización del proyecto, configuración de Prisma y MySQL, creación de módulos, servicios, controladores y DTOs, definición de endpoints, implementación de lógica de negocio. La explicación debe ser clara, detallada y secuencial, demostrando comprensión de cada componente. La duración estimada de esta sesión es de 2 horas.

3. **Presentación de una Evaluación de Conocimientos**: El estudiante debe presentar una evaluación de conocimientos de todo lo visto durante el trimestre. Cubriendo temas como: conceptos básicos de NestJS (módulos, controladores, servicios), uso de Prisma (esquemas, migraciones, queries), MySQL (relaciones, enums), principios RESTful, validación de datos, manejo de errores. La duración estimada de esta evaluación es de 1 horas.

Estas condiciones serán evaluadas por un instructor o evaluador, y el aprendiz debe cumplir con todas para aprobar el plan de mejoramiento. 
